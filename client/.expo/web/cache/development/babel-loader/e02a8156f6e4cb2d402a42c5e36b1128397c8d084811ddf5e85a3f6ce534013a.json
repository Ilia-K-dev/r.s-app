{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { useState, useCallback } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { Card } from \"../../../shared/components/ui/Card\";\nimport { Button } from \"../../../shared/components/forms/Button\";\nimport { Alert } from \"../../../shared/components/ui/Alert\";\nimport { useToast } from \"../../../shared/hooks/useToast\";\nimport { useReceipts } from \"../hooks/useReceipts\";\nimport { Camera, Upload, X, Image } from 'lucide-react';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar MAX_FILE_SIZE = 5 * 1024 * 1024;\nvar ACCEPTED_TYPES = {\n  'image/jpeg': ['.jpg', '.jpeg'],\n  'image/png': ['.png'],\n  'image/heic': ['.heic']\n};\nexport var ReceiptUploader = function ReceiptUploader(_ref) {\n  var onSuccess = _ref.onSuccess,\n    _ref$className = _ref.className,\n    className = _ref$className === void 0 ? '' : _ref$className;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    file = _useState2[0],\n    setFile = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    preview = _useState4[0],\n    setPreview = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    error = _useState8[0],\n    setError = _useState8[1];\n  var _useReceipts = useReceipts(),\n    addReceipt = _useReceipts.addReceipt;\n  var _useToast = useToast(),\n    showToast = _useToast.showToast;\n  var onDrop = useCallback(function (acceptedFiles) {\n    var file = acceptedFiles[0];\n    if (file) {\n      if (file.size > MAX_FILE_SIZE) {\n        setError(`File size exceeds ${MAX_FILE_SIZE / (1024 * 1024)}MB limit`);\n        showToast(`File size exceeds ${MAX_FILE_SIZE / (1024 * 1024)}MB limit`, 'error');\n        return;\n      }\n      var previewUrl = URL.createObjectURL(file);\n      setFile(file);\n      setPreview(previewUrl);\n      setError(null);\n    }\n  }, [showToast]);\n  var _useDropzone = useDropzone({\n      onDrop: onDrop,\n      accept: ACCEPTED_TYPES,\n      maxSize: MAX_FILE_SIZE,\n      multiple: false\n    }),\n    getRootProps = _useDropzone.getRootProps,\n    getInputProps = _useDropzone.getInputProps,\n    isDragActive = _useDropzone.isDragActive;\n  var handleUpload = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      if (!file) return;\n      try {\n        setLoading(true);\n        setError(null);\n        var receiptData = {\n          date: new Date().toISOString().split('T')[0],\n          total: 0,\n          merchant: 'Unknown',\n          category: ''\n        };\n        var result = yield addReceipt(receiptData, file);\n        showToast('Receipt uploaded successfully', 'success');\n        handleClear();\n        if (onSuccess) {\n          onSuccess(result);\n        }\n      } catch (err) {\n        setError(err.message);\n        showToast(err.message, 'error');\n        console.error('Error adding receipt:', err);\n        throw err;\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function handleUpload() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var handleClear = function handleClear() {\n    if (preview) {\n      URL.revokeObjectURL(preview);\n    }\n    setFile(null);\n    setPreview(null);\n    setError(null);\n  };\n  return _jsxs(Card, {\n    className: `p-6 ${className}`,\n    children: [error && _jsx(Alert, {\n      type: \"error\",\n      message: error,\n      className: \"mb-4\"\n    }), !file ? _jsxs(\"div\", _objectSpread(_objectSpread({}, getRootProps()), {}, {\n      className: `\n          border-2 border-dashed rounded-lg p-6 text-center \n          transition-colors duration-200 cursor-pointer\n          ${isDragActive ? 'border-primary-500 bg-primary-50' : 'border-gray-300 hover:border-primary-400'}\n        `,\n      children: [_jsx(\"input\", _objectSpread({}, getInputProps())), _jsx(Upload, {\n        className: \"mx-auto h-12 w-12 text-gray-400\"\n      }), _jsx(\"p\", {\n        className: \"mt-2 text-sm text-gray-600\",\n        children: isDragActive ? 'Drop the receipt here...' : 'Drop a receipt or click to upload'\n      }), _jsx(\"p\", {\n        className: \"text-xs text-gray-500 mt-1\",\n        children: \"Supported formats: JPG, PNG, HEIC (max 5MB)\"\n      })]\n    })) : _jsxs(\"div\", {\n      className: \"space-y-4\",\n      children: [_jsxs(\"div\", {\n        className: \"relative\",\n        children: [_jsx(\"img\", {\n          src: preview,\n          alt: \"Receipt preview\",\n          className: \"w-full rounded-lg\"\n        }), _jsx(Button, {\n          className: \"absolute top-2 right-2\",\n          variant: \"secondary\",\n          size: \"sm\",\n          icon: X,\n          onClick: handleClear,\n          disabled: loading,\n          children: \"Clear\"\n        })]\n      }), _jsxs(\"div\", {\n        className: \"flex justify-end space-x-2\",\n        children: [_jsx(Button, {\n          variant: \"secondary\",\n          onClick: handleClear,\n          disabled: loading,\n          children: \"Cancel\"\n        }), _jsx(Button, {\n          onClick: handleUpload,\n          loading: loading,\n          disabled: loading,\n          icon: Upload,\n          children: \"Upload Receipt\"\n        })]\n      })]\n    })]\n  });\n};\nexport default ReceiptUploader;","map":{"version":3,"names":["React","useState","useCallback","useDropzone","Card","Button","Alert","useToast","useReceipts","Camera","Upload","X","Image","jsx","_jsx","jsxs","_jsxs","MAX_FILE_SIZE","ACCEPTED_TYPES","ReceiptUploader","_ref","onSuccess","_ref$className","className","_useState","_useState2","_slicedToArray","file","setFile","_useState3","_useState4","preview","setPreview","_useState5","_useState6","loading","setLoading","_useState7","_useState8","error","setError","_useReceipts","addReceipt","_useToast","showToast","onDrop","acceptedFiles","size","previewUrl","URL","createObjectURL","_useDropzone","accept","maxSize","multiple","getRootProps","getInputProps","isDragActive","handleUpload","_ref2","_asyncToGenerator","receiptData","date","Date","toISOString","split","total","merchant","category","result","handleClear","err","message","console","apply","arguments","revokeObjectURL","children","type","_objectSpread","src","alt","variant","icon","onClick","disabled"],"sources":["C:/Users/user/Documents/app.v3/client/src/features/receipts/components/ReceiptUploader.js"],"sourcesContent":["import React, { useState, useCallback } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport { Card } from '../../../shared/components/ui/Card';\r\nimport { Button } from '../../../shared/components/forms/Button';\r\nimport { Alert } from '../../../shared/components/ui/Alert';\r\nimport { useToast } from '../../../shared/hooks/useToast';\r\nimport { useReceipts } from '../hooks/useReceipts';\r\nimport { Camera, Upload, X, Image } from 'lucide-react';\r\n\r\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\r\nconst ACCEPTED_TYPES = {\r\n  'image/jpeg': ['.jpg', '.jpeg'],\r\n  'image/png': ['.png'],\r\n  'image/heic': ['.heic']\r\n};\r\n\r\nexport const ReceiptUploader = ({ onSuccess, className = '' }) => {\r\n  const [file, setFile] = useState(null);\r\n  const [preview, setPreview] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const { addReceipt } = useReceipts();\r\n  const { showToast } = useToast();\r\n\r\n  // Handle dropped or selected files\r\n  const onDrop = useCallback((acceptedFiles) => {\r\n    const file = acceptedFiles[0];\r\n    if (file) {\r\n      // Validate file size\r\n      if (file.size > MAX_FILE_SIZE) {\r\n        setError(`File size exceeds ${MAX_FILE_SIZE / (1024 * 1024)}MB limit`);\r\n        showToast(`File size exceeds ${MAX_FILE_SIZE / (1024 * 1024)}MB limit`, 'error');\r\n        return;\r\n      }\r\n\r\n      // Create preview\r\n      const previewUrl = URL.createObjectURL(file);\r\n      setFile(file);\r\n      setPreview(previewUrl);\r\n      setError(null);\r\n    }\r\n  }, [showToast]);\r\n\r\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n    onDrop,\r\n    accept: ACCEPTED_TYPES,\r\n    maxSize: MAX_FILE_SIZE,\r\n    multiple: false\r\n  });\r\n\r\n  // Handle the upload process\r\n  const handleUpload = async () => {\r\n    if (!file) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // Create a basic receipt object\r\n      const receiptData = {\r\n        date: new Date().toISOString().split('T')[0],\r\n        total: 0, // Will be updated by OCR\r\n        merchant: 'Unknown', // Will be updated by OCR\r\n        category: ''\r\n      };\r\n\r\n      // Upload to server for processing\r\n      const result = await addReceipt(receiptData, file);\r\n      \r\n      // Show success message\r\n      showToast('Receipt uploaded successfully', 'success');\r\n      \r\n      // Reset the component\r\n      handleClear();\r\n      \r\n      // Notify parent component\r\n      if (onSuccess) {\r\n        onSuccess(result);\r\n      }\r\n    } catch (err) {\r\n      setError(err.message);\r\n      showToast(err.message, 'error');\r\n      console.error('Error adding receipt:', err);\r\n      throw err;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Clear the selected file and preview\r\n  const handleClear = () => {\r\n    if (preview) {\r\n      URL.revokeObjectURL(preview);\r\n    }\r\n    setFile(null);\r\n    setPreview(null);\r\n    setError(null);\r\n  };\r\n\r\n  return (\r\n    <Card className={`p-6 ${className}`}>\r\n      {error && (\r\n        <Alert\r\n          type=\"error\"\r\n          message={error}\r\n          className=\"mb-4\"\r\n        />\r\n      )}\r\n\r\n      {!file ? (\r\n        <div {...getRootProps()} className={`\r\n          border-2 border-dashed rounded-lg p-6 text-center \r\n          transition-colors duration-200 cursor-pointer\r\n          ${isDragActive ? 'border-primary-500 bg-primary-50' : 'border-gray-300 hover:border-primary-400'}\r\n        `}>\r\n          <input {...getInputProps()} />\r\n          <Upload className=\"mx-auto h-12 w-12 text-gray-400\" />\r\n          <p className=\"mt-2 text-sm text-gray-600\">\r\n            {isDragActive ? 'Drop the receipt here...' : 'Drop a receipt or click to upload'}\r\n          </p>\r\n          <p className=\"text-xs text-gray-500 mt-1\">\r\n            Supported formats: JPG, PNG, HEIC (max 5MB)\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"relative\">\r\n            <img\r\n              src={preview}\r\n              alt=\"Receipt preview\"\r\n              className=\"w-full rounded-lg\"\r\n            />\r\n            <Button\r\n              className=\"absolute top-2 right-2\"\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n              icon={X}\r\n              onClick={handleClear}\r\n              disabled={loading}\r\n            >\r\n              Clear\r\n            </Button>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end space-x-2\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={handleClear}\r\n              disabled={loading}\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              onClick={handleUpload}\r\n              loading={loading}\r\n              disabled={loading}\r\n              icon={Upload}\r\n            >\r\n              Upload Receipt\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default ReceiptUploader;\r\n"],"mappings":";;;;;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AACpD,SAASC,WAAW,QAAQ,gBAAgB;AAC5C,SAASC,IAAI;AACb,SAASC,MAAM;AACf,SAASC,KAAK;AACd,SAASC,QAAQ;AACjB,SAASC,WAAW;AACpB,SAASC,MAAM,EAAEC,MAAM,EAAEC,CAAC,EAAEC,KAAK,QAAQ,cAAc;AAAC,SAAAC,GAAA,IAAAC,IAAA,EAAAC,IAAA,IAAAC,KAAA;AAExD,IAAMC,aAAa,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI;AACrC,IAAMC,cAAc,GAAG;EACrB,YAAY,EAAE,CAAC,MAAM,EAAE,OAAO,CAAC;EAC/B,WAAW,EAAE,CAAC,MAAM,CAAC;EACrB,YAAY,EAAE,CAAC,OAAO;AACxB,CAAC;AAED,OAAO,IAAMC,eAAe,GAAG,SAAlBA,eAAeA,CAAAC,IAAA,EAAsC;EAAA,IAAhCC,SAAS,GAAAD,IAAA,CAATC,SAAS;IAAAC,cAAA,GAAAF,IAAA,CAAEG,SAAS;IAATA,SAAS,GAAAD,cAAA,cAAG,EAAE,GAAAA,cAAA;EACzD,IAAAE,SAAA,GAAwBvB,QAAQ,CAAC,IAAI,CAAC;IAAAwB,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAA/BG,IAAI,GAAAF,UAAA;IAAEG,OAAO,GAAAH,UAAA;EACpB,IAAAI,UAAA,GAA8B5B,QAAQ,CAAC,IAAI,CAAC;IAAA6B,UAAA,GAAAJ,cAAA,CAAAG,UAAA;IAArCE,OAAO,GAAAD,UAAA;IAAEE,UAAU,GAAAF,UAAA;EAC1B,IAAAG,UAAA,GAA8BhC,QAAQ,CAAC,KAAK,CAAC;IAAAiC,UAAA,GAAAR,cAAA,CAAAO,UAAA;IAAtCE,OAAO,GAAAD,UAAA;IAAEE,UAAU,GAAAF,UAAA;EAC1B,IAAAG,UAAA,GAA0BpC,QAAQ,CAAC,IAAI,CAAC;IAAAqC,UAAA,GAAAZ,cAAA,CAAAW,UAAA;IAAjCE,KAAK,GAAAD,UAAA;IAAEE,QAAQ,GAAAF,UAAA;EACtB,IAAAG,YAAA,GAAuBjC,WAAW,CAAC,CAAC;IAA5BkC,UAAU,GAAAD,YAAA,CAAVC,UAAU;EAClB,IAAAC,SAAA,GAAsBpC,QAAQ,CAAC,CAAC;IAAxBqC,SAAS,GAAAD,SAAA,CAATC,SAAS;EAGjB,IAAMC,MAAM,GAAG3C,WAAW,CAAC,UAAC4C,aAAa,EAAK;IAC5C,IAAMnB,IAAI,GAAGmB,aAAa,CAAC,CAAC,CAAC;IAC7B,IAAInB,IAAI,EAAE;MAER,IAAIA,IAAI,CAACoB,IAAI,GAAG9B,aAAa,EAAE;QAC7BuB,QAAQ,CAAC,qBAAqBvB,aAAa,IAAI,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC;QACtE2B,SAAS,CAAC,qBAAqB3B,aAAa,IAAI,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,OAAO,CAAC;QAChF;MACF;MAGA,IAAM+B,UAAU,GAAGC,GAAG,CAACC,eAAe,CAACvB,IAAI,CAAC;MAC5CC,OAAO,CAACD,IAAI,CAAC;MACbK,UAAU,CAACgB,UAAU,CAAC;MACtBR,QAAQ,CAAC,IAAI,CAAC;IAChB;EACF,CAAC,EAAE,CAACI,SAAS,CAAC,CAAC;EAEf,IAAAO,YAAA,GAAsDhD,WAAW,CAAC;MAChE0C,MAAM,EAANA,MAAM;MACNO,MAAM,EAAElC,cAAc;MACtBmC,OAAO,EAAEpC,aAAa;MACtBqC,QAAQ,EAAE;IACZ,CAAC,CAAC;IALMC,YAAY,GAAAJ,YAAA,CAAZI,YAAY;IAAEC,aAAa,GAAAL,YAAA,CAAbK,aAAa;IAAEC,YAAY,GAAAN,YAAA,CAAZM,YAAY;EAQjD,IAAMC,YAAY;IAAA,IAAAC,KAAA,GAAAC,iBAAA,CAAG,aAAY;MAC/B,IAAI,CAACjC,IAAI,EAAE;MAEX,IAAI;QACFS,UAAU,CAAC,IAAI,CAAC;QAChBI,QAAQ,CAAC,IAAI,CAAC;QAGd,IAAMqB,WAAW,GAAG;UAClBC,IAAI,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;UAC5CC,KAAK,EAAE,CAAC;UACRC,QAAQ,EAAE,SAAS;UACnBC,QAAQ,EAAE;QACZ,CAAC;QAGD,IAAMC,MAAM,SAAS3B,UAAU,CAACmB,WAAW,EAAElC,IAAI,CAAC;QAGlDiB,SAAS,CAAC,+BAA+B,EAAE,SAAS,CAAC;QAGrD0B,WAAW,CAAC,CAAC;QAGb,IAAIjD,SAAS,EAAE;UACbA,SAAS,CAACgD,MAAM,CAAC;QACnB;MACF,CAAC,CAAC,OAAOE,GAAG,EAAE;QACZ/B,QAAQ,CAAC+B,GAAG,CAACC,OAAO,CAAC;QACrB5B,SAAS,CAAC2B,GAAG,CAACC,OAAO,EAAE,OAAO,CAAC;QAC/BC,OAAO,CAAClC,KAAK,CAAC,uBAAuB,EAAEgC,GAAG,CAAC;QAC3C,MAAMA,GAAG;MACX,CAAC,SAAS;QACRnC,UAAU,CAAC,KAAK,CAAC;MACnB;IACF,CAAC;IAAA,gBApCKsB,YAAYA,CAAA;MAAA,OAAAC,KAAA,CAAAe,KAAA,OAAAC,SAAA;IAAA;EAAA,GAoCjB;EAGD,IAAML,WAAW,GAAG,SAAdA,WAAWA,CAAA,EAAS;IACxB,IAAIvC,OAAO,EAAE;MACXkB,GAAG,CAAC2B,eAAe,CAAC7C,OAAO,CAAC;IAC9B;IACAH,OAAO,CAAC,IAAI,CAAC;IACbI,UAAU,CAAC,IAAI,CAAC;IAChBQ,QAAQ,CAAC,IAAI,CAAC;EAChB,CAAC;EAED,OACExB,KAAA,CAACZ,IAAI;IAACmB,SAAS,EAAE,OAAOA,SAAS,EAAG;IAAAsD,QAAA,GACjCtC,KAAK,IACJzB,IAAA,CAACR,KAAK;MACJwE,IAAI,EAAC,OAAO;MACZN,OAAO,EAAEjC,KAAM;MACfhB,SAAS,EAAC;IAAM,CACjB,CACF,EAEA,CAACI,IAAI,GACJX,KAAA,QAAA+D,aAAA,CAAAA,aAAA,KAASxB,YAAY,CAAC,CAAC;MAAEhC,SAAS,EAAE;AAC5C;AACA;AACA,YAAYkC,YAAY,GAAG,kCAAkC,GAAG,0CAA0C;AAC1G,SAAU;MAAAoB,QAAA,GACA/D,IAAA,UAAAiE,aAAA,KAAWvB,aAAa,CAAC,CAAC,CAAG,CAAC,EAC9B1C,IAAA,CAACJ,MAAM;QAACa,SAAS,EAAC;MAAiC,CAAE,CAAC,EACtDT,IAAA;QAAGS,SAAS,EAAC,4BAA4B;QAAAsD,QAAA,EACtCpB,YAAY,GAAG,0BAA0B,GAAG;MAAmC,CAC/E,CAAC,EACJ3C,IAAA;QAAGS,SAAS,EAAC,4BAA4B;QAAAsD,QAAA,EAAC;MAE1C,CAAG,CAAC;IAAA,EACD,CAAC,GAEN7D,KAAA;MAAKO,SAAS,EAAC,WAAW;MAAAsD,QAAA,GACxB7D,KAAA;QAAKO,SAAS,EAAC,UAAU;QAAAsD,QAAA,GACvB/D,IAAA;UACEkE,GAAG,EAAEjD,OAAQ;UACbkD,GAAG,EAAC,iBAAiB;UACrB1D,SAAS,EAAC;QAAmB,CAC9B,CAAC,EACFT,IAAA,CAACT,MAAM;UACLkB,SAAS,EAAC,wBAAwB;UAClC2D,OAAO,EAAC,WAAW;UACnBnC,IAAI,EAAC,IAAI;UACToC,IAAI,EAAExE,CAAE;UACRyE,OAAO,EAAEd,WAAY;UACrBe,QAAQ,EAAElD,OAAQ;UAAA0C,QAAA,EACnB;QAED,CAAQ,CAAC;MAAA,CACN,CAAC,EAEN7D,KAAA;QAAKO,SAAS,EAAC,4BAA4B;QAAAsD,QAAA,GACzC/D,IAAA,CAACT,MAAM;UACL6E,OAAO,EAAC,WAAW;UACnBE,OAAO,EAAEd,WAAY;UACrBe,QAAQ,EAAElD,OAAQ;UAAA0C,QAAA,EACnB;QAED,CAAQ,CAAC,EACT/D,IAAA,CAACT,MAAM;UACL+E,OAAO,EAAE1B,YAAa;UACtBvB,OAAO,EAAEA,OAAQ;UACjBkD,QAAQ,EAAElD,OAAQ;UAClBgD,IAAI,EAAEzE,MAAO;UAAAmE,QAAA,EACd;QAED,CAAQ,CAAC;MAAA,CACN,CAAC;IAAA,CACH,CACN;EAAA,CACG,CAAC;AAEX,CAAC;AAED,eAAe1D,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}